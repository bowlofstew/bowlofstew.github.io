---
layout: post
title: 09-27-2016 Check-In
comments: true
permalink: 09272016-check-in
tags:
  - daily
  - avro
  - soylent
---

<div><!-- <a href="https://twitter.com/share" class="twitter-share-button" data-via="__shenderson__">Tweet</a> --><a class="twitter-follow-button" data-show-count="false" href="https://twitter.com/__shenderson__">Follow @__shenderson__</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

&nbsp;

#FAIL

  * [Soylent supply chain management](https://faq.soylent.com/hc/en-us/articles/213582543-Soylent-Powder-is-Backordered) - Apparently I am going to not get another shipment of Soylent for about a month due to some cluster mess.  This doesn't appear to be their first supply chain issue.

  * Debugging Avro.  Most of the previous issues are around another system attempting to defeat the type system provided by making each type a member of a union between null and a type.  This goes into the realm of so ugly only a mother could love it.

Useful Scala code related tidbits for debugging Avro:

Building an Avro schema:
  
  `
  val personSchema = SchemaBuilder
    .record("person")
    .fields
    .name("name").`type`().stringType().stringDefault("name")
    .name("ID").`type`().intType().noDefault()
    .endRecord
  `

Create an Avro record (notice that name is default-able to name):

  `
  val person = new GenericRecordBuilder(personSchema)
      .set("ID", 1)
      .build
  `

This creates the following if you convert the above object to string format:

  `
  {"name":"name", "ID": 1}
  `

Avro I/O utilities:

  `
  def avroSchema(json: String): Schema = (new Schema.Parser).parse(json)

  def readAs(file: File, writeSchema: Schema, readSchema: Schema): GenericRecord = {
    val dataFileReader = new DataFileReader[GenericRecord](
      file,
      new GenericDatumReader[GenericRecord](writeSchema, readSchema)
    )
    dataFileReader.next(null)
  }

  def writeAs(file: File, schema: AvroSchema)(rec: GenericRecord) = {
    val dataFileWriter = new DataFileWriter[GenericRecord](
        new GenericDatumWriter[GenericRecord](schema))
    dataFileWriter.create(schema, file)
    dataFileWriter.append(rec)
    dataFileWriter.close()
  }
  `

Read in an Avro Schema:

  `
  val file = new File("personWithName.avro")
  file.deleteOnExit()
  
  val person = new GenericRecordBuilder(personSchema)
      .set("ID", 1)
      .build

  writeAs(file, personSchema)(person)

  val personReadSchema = SchemaBuilder
      .record("person")
      .fields
      .name("name").`type`().stringType().stringDefault("name")
      .name("ID").`type`().intType().noDefault()
      .endRecord

  val rec = readAs(file, personSchema, personReadSchema)
  `